# Bank Statement Parser

A Python tool to extract and parse bank statement files from multiple Indonesian banks and convert them to standardized CSV format for easier analysis and record-keeping.

## ⚠️ Data Privacy Warning

**Notice**: This tool processes bank statement files that contain personal financial information. Store processed files securely and do not share CSV exports publicly.

## Supported Banks

- **BCA** (Bank Central Asia) - PDF format
- **Mandiri** (Bank Mandiri) - Excel format (.xlsx, .xls)
- **CIMB** (Bank CIMB Niaga) - PDF format

## Features

- **Automatic Bank Detection**: Recognizes default bank download filenames and custom naming patterns
- **Recursive File Search**: Finds all statement files in folders and subfolders automatically
- **Bank-Specific Parsing**: Uses dedicated parsers for each bank's unique statement format
- **Transaction Extraction**: Extracts date, description, amounts, balances, and reference numbers
- **Standardized Output**: Exports data to CSV with consistent columns across all banks
- **Account Information**: Automatically extracts account owner name and account number
- **Batch Processing**: Process all files of a specific bank or all banks at once
- **Mixed File Handling**: Safely processes folders with random files (validates file content)

## Installation

### Requirements

- Python 3.7+
- pandas
- pdfplumber
- openpyxl

### Setup

1. Clone or download the repository
2. Install dependencies:

```bash
pip install -r requirements.txt
```

## Usage

### Basic Usage

Process all bank statements of a specific bank:

```bash
python process_statements.py /path/to/statements bca
python process_statements.py /path/to/statements mandiri
python process_statements.py /path/to/statements cimb
```

### Process All Banks

Process files from all supported banks:

```bash
python process_statements.py /path/to/statements all
```

Or simply omit the bank parameter (defaults to 'all'):

```bash
python process_statements.py /path/to/statements
```

### Specify Output Directory

Save processed CSV files to a custom location:

```bash
python process_statements.py /path/to/statements bca -o /path/to/output
```

Or use the long form:

```bash
python process_statements.py /path/to/statements bca --output /path/to/output
```

## Input File Requirements

### Automatic File Detection

The tool **automatically detects and parses** bank statements using the default download filenames generated by each bank. Just point it to a folder and it will identify and process the correct files.

**Supported Default Filenames:**

**BCA:**
```
[AccountNumber]_[MONTH]_[YEAR].pdf
Example: [ACCOUNT_NUMBER]_JUL_2025.pdf
```

**Mandiri:**
```
e-Statement_[AccountNumber]_[StartDate]-[EndDate].xlsx
Example: e-Statement_[ACCOUNT_NUMBER]_01 Apr 2024-30 Apr 2024.xlsx
```

**CIMB:**
```
CASA_Statement_[Date][Timestamp].pdf
Example: CASA_Statement_Nov2025_[TIMESTAMP].pdf
```

### Custom Naming

You can also rename files with the bank name or keywords. The tool will recognize:

| Bank | Accepted Patterns |
|------|-------------------|
| BCA | Filename contains "bca" or month names (JUL, AGUST, SEPT, OKT, NOV, DES, JAN, FEB, MAR, APR, MEI, JUN) |
| Mandiri | Filename contains "mandiri" or starts with "e-statement" |
| CIMB | Filename contains "cimb" or "casa" |

### File Filtering

The tool uses a **3-step validation process** to ensure accuracy:

1. **Filename Pattern Check**: File must match bank's naming pattern
2. **Extension Check**: File must have the correct format (pdf for BCA/CIMB, xlsx/xls for Mandiri)
3. **Content Validation**: First page/rows scanned for bank-specific keywords

This prevents false positives and ensures only real bank statements are processed.

## Output Format

The tool generates CSV files with the following columns:

| Column | Description |
|--------|-------------|
| Date | Transaction date (YYYY-MM-DD) |
| Description | Transaction details/memo |
| Reference No | Transaction reference number |
| Debit | Amount withdrawn (if applicable) |
| Credit | Amount deposited (if applicable) |
| Balance | Account balance after transaction |
| Bank | Bank name (BCA, Mandiri, CIMB) |
| Owner | Account owner name |

### Output Filename Format

```
{BankName}-[{OwnerName}]-{AccountNumber}-{StartDate}-{EndDate}.csv
```

Example:
```
BCA-[Account Owner]-0123456789-01122025-31122025.csv
```

## Examples

### Example 1: Process BCA statements

```bash
python process_statements.py "C:\Users\Documents\Statements" bca
```

The tool automatically finds and processes files like:
- `[ACCOUNT_NUMBER]_JUL_2025.pdf`
- `[ACCOUNT_NUMBER]_AUG_2025.pdf`
- Any files with "bca" in the name

### Example 2: Process all banks with custom output

```bash
python process_statements.py "D:\Financial\2025" all -o "D:\Processed"
```

Automatically searches for and processes:
- BCA files: `[ACCOUNT_NUMBER]_[MONTH]_[YEAR].pdf` or files with "bca"
- Mandiri files: `e-Statement_*.xlsx` or files with "mandiri"
- CIMB files: `CASA_Statement_*.pdf` or files with "cimb"

Exports results to `D:\Processed\`

### Example 3: Process Mandiri statements from nested folders

```bash
python process_statements.py "D:\Financial\2025" mandiri
```

Recursively finds all Mandiri files:
- `e-Statement_[ACCOUNT_NUMBER]_01 Apr 2024-30 Apr 2024.xlsx`
- `e-Statement_*.xlsx` pattern
- Files with "mandiri" in the name

### Example 4: Process CIMB statements with custom output

```bash
python process_statements.py "E:\Bank Statements\CIMB" cimb -o "E:\Processed"
```

Finds and processes files like:
- `CASA_Statement_Nov2025_[TIMESTAMP].pdf`
- `casa_*.pdf` pattern
- Files with "cimb" in the name

## File Structure

```
bank-statement-parsers/
├── base.py                    # Base parser class and Transaction dataclass
├── bca.py                     # BCA-specific parser
├── mandiri.py                 # Mandiri-specific parser
├── cimb.py                    # CIMB-specific parser
├── process_statements.py      # Main script with CLI interface
├── requirements.txt           # Python dependencies
├── README.md                  # This file
└── output/                    # Generated CSV files (created automatically)
    ├── BCA-[Owner]-number-dates.csv
    ├── Mandiri-[Owner]-number-dates.csv
    └── CIMB-[Owner]-number-dates.csv
```

## How It Works

1. **File Discovery**: Searches the specified folder recursively for files matching bank patterns
2. **Parser Selection**: Determines which parser to use based on filename and extension
3. **Account Extraction**: Reads the statement to extract account owner and account number
4. **Transaction Parsing**: Extracts each transaction with:
   - Date
   - Description
   - Debit/Credit amounts
   - Running balance
   - Reference numbers
5. **CSV Export**: Creates a standardized CSV file with all transactions

## Safety & File Filtering

### Handling Mixed File Types

The tool is safe to run on folders with lots of random files. It uses smart filtering:

**3-Level Validation:**

1. **Filename Filter** - Only considers files with bank name (bca, mandiri, cimb)
2. **Extension Filter** - Only processes correct file types (.pdf for BCA/CIMB, .xlsx/.xls for Mandiri)
3. **Content Validation** - Scans file content for bank-specific keywords before processing

### What Gets Processed

✓ PDF with "bca" in name + contains "mutasi rekening" = **PROCESSED**
✓ Excel with "mandiri" in name + contains "bank mandiri" = **PROCESSED**

### What Gets Skipped

✗ `random_ebook.pdf` - No bank name in filename = **SKIPPED**
✗ `bca_invoice.pdf` - Has "bca" but wrong content = **SKIPPED**
✗ `mandiri.docx` - Wrong file extension = **SKIPPED**
✗ `statement.xlsx` - No bank name = **SKIPPED**

### Running on Large Folders

Safe to run on folders with thousands of files. The tool will:
- Print validation messages for each file it checks
- Only process files that match all criteria
- Skip non-matching files silently
- Report which files are valid statements

Example output:
```
Searching for BCA files in C:\My Documents\...
  ✓ Valid statement: C:\My Documents\Statements\bca-2025-jan.pdf
  ✗ Skipped (not a valid BCA statement): C:\My Documents\ebooks\bca-guide.pdf
  ✗ Skipped (wrong extension): C:\My Documents\Mandiri\bca-statement.xlsx
Processing 1 BCA file(s)...
```

### Bank-Specific Keywords

The tool looks for the following keywords in file content to validate statements:

**BCA Keywords:**
- "bca"
- "bank central"
- "mutasi rekening"
- "saldo"
- "rekening"

**Mandiri Keywords:**
- "mandiri"
- "bank mandiri"
- "laporan transaksi"
- "tanggal"
- "uraian"

**CIMB Keywords:**
- "cimb"
- "casa"
- "bank cimb"
- "mutasi rekening"

### Examples of Files That Will Be Processed

✓ `[ACCOUNT_NUMBER]_JUL_2025.pdf` - BCA default name (account number + month + year)
✓ `e-Statement_[ACCOUNT_NUMBER]_01 Apr 2024-30 Apr 2024.xlsx` - Mandiri default name
✓ `CASA_Statement_Nov2025_[TIMESTAMP].pdf` - CIMB default name
✓ `bca-statement-2025.pdf` - Custom BCA name
✓ `mandiri-january-2025.xlsx` - Custom Mandiri name

### Examples of Files That Will Be Skipped

✗ `statement_2025.pdf` - No bank identifier
✗ `bca_invoice.pdf` - Has bank name but wrong content
✗ `mandiri_notes.pdf` - Wrong extension (.pdf instead of .xlsx)
✗ `CASA_document.docx` - Wrong extension (.docx instead of .pdf)
✗ `random_file.xlsx` - No bank identifier in name

## Data Privacy & Security

**Notice**: This tool processes financial documents containing personal and sensitive information including account numbers, balances, and transaction details. Store files securely and do not share CSV exports publicly.

### What Information the Tool Processes

The tool extracts and stores:
- Account numbers
- Account owner names
- Transaction details and amounts
- Reference numbers
- Account balances

### Best Practices

1. **Store in secure location**:
   - Don't keep in public/shared locations
   - Use encrypted storage if available
   - Set appropriate file permissions

2. **Handle CSV exports carefully**:
   - Do not share via email or cloud without encryption
   - Do not commit to public git repositories
   - Delete processed files when no longer needed

3. **Keep original statement files secure**:
   - Store with the same security as you would at the bank
   - Delete original files after processing if you don't need them
   - Do not share file names or locations with others

## Troubleshooting

### "No matching bank statement files were found" or "Skipped (not a valid [BANK] statement)"

**Causes:**
- Filename doesn't contain the bank name
- File extension is incorrect for the bank
- File content doesn't match bank-specific keywords
- PDF/Excel file is corrupted or uses non-standard format

**Solutions:**
1. Check filename contains bank keyword:
   - ✓ Good: `bca-december-2025.pdf`
   - ✗ Bad: `december-2025.pdf` (missing "bca")

2. Check file extension:
   - BCA/CIMB must end with `.pdf`
   - Mandiri must end with `.xlsx` or `.xls`

3. Verify it's a real bank statement by opening the file manually

4. Rename file to include bank name if needed:
   ```bash
   # Rename to include bank name
   mv December-Statement.pdf bca-December-Statement.pdf
   ```

### "Skipped (error validating)"

The tool couldn't read the file to validate content. This might be due to:
- File is corrupted
- Unusual file encoding
- File permissions
- Non-standard format

Try opening the file in a PDF reader or Excel to verify it's valid.

### "No transactions found in [filename]"

- The statement format may have changed
- The file may be empty or contain no transaction data
- The statement may use an unsupported format variant

### "Error parsing [bank name] file"

- The statement format differs from what the parser expects
- Try opening the file manually to check its structure
- Report the issue if it's a valid bank statement with unexpected format

### File Processing Output Meanings

- `✓ Valid statement:` File passed all validation checks and will be processed
- `✗ Skipped (not a valid [BANK] statement):` File matched criteria but content didn't match
- `✗ Skipped (error validating):` File couldn't be read or validated

## Supported Python Versions

- Python 3.7+
- Python 3.8+
- Python 3.9+
- Python 3.10+
- Python 3.11+

## Dependencies

See `requirements.txt` for the complete list:

```
pandas>=1.0.0
pdfplumber>=0.5.0
openpyxl>=3.0.0
```

## License

This project is provided as-is for personal use.

## Notes

- The tool is specifically designed for Indonesian bank statements
- Date formats and transaction structures are Indonesian bank-specific
- Account owners and numbers are extracted automatically from statements
- Transaction descriptions are extracted as-is from the statements

## Support

For issues or questions:
1. Check the Troubleshooting section
2. Verify your input files match the required format
3. Review the output in the `/output` folder
4. Check console output for detailed error messages
